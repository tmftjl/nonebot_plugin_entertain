<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Membership 管理控制台</title>
  <link rel="stylesheet" href="/membership/static/console.css">
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="Membership 管理控制台 - 轻量后台">
</head>
<body>
  <!-- Toast 通知容器 -->
  <div id="toast-container"></div>

  <!-- 加载遮罩 -->
  <div id="loading-overlay" class="hidden">
    <div class="spinner"></div>
    <div class="loading-text">加载中...</div>
  </div>

  <!-- 应用容器 -->
  <div id="app">
    <!-- 顶部导航 -->
    <header class="top-bar">
      <div class="top-bar-left">
        <h1 class="logo">
          <span class="logo-icon">🌸</span>
          <span class="logo-text">Membership 控制台</span>
        </h1>
      </div>
      <div class="top-bar-right">
        <button id="theme-toggle" class="icon-btn" title="切换主题" aria-label="切换主题">
          <span class="icon">🌙</span>
        </button>
        <button id="refresh-btn" class="icon-btn" title="刷新" aria-label="刷新">
          <span class="icon">🔄</span>
        </button>
      </div>
    </header>

    <div class="main-container">
      <!-- 侧边导航 -->
      <aside class="sidebar">
        <nav class="nav-menu" role="navigation" aria-label="主导航">
          <a href="#dashboard" class="nav-item active" data-tab="dashboard" role="button">
            <span class="nav-icon">📊</span>
            <span class="nav-text">仪表盘</span>
          </a>
          <a href="#renewal" class="nav-item" data-tab="renewal" role="button">
            <span class="nav-icon">💰</span>
            <span class="nav-text">会员续费</span>
          </a>
          <a href="#stats" class="nav-item" data-tab="stats" role="button">
            <span class="nav-icon">📈</span>
            <span class="nav-text">消息统计</span>
          </a>
          <a href="#permissions" class="nav-item" data-tab="permissions" role="button">
            <span class="nav-icon">🔐</span>
            <span class="nav-text">权限管理</span>
          </a>
          <a href="#config" class="nav-item" data-tab="config" role="button">
            <span class="nav-icon">⚙️</span>
            <span class="nav-text">配置管理</span>
          </a>
        </nav>
      </aside>

      <!-- 内容区 -->
      <main class="content-area" role="main">
        <!-- 仪表盘 -->
        <section id="tab-dashboard" class="tab-content active">
          <h2 class="page-title">📊 仪表盘总览</h2>
          <div class="stats-cards">
            <div class="stat-card" role="status" aria-label="群组统计">
              <div class="stat-icon">👥</div>
              <div class="stat-info">
                <div class="stat-label">群组总数</div>
                <div id="stat-active-groups" class="stat-value">-</div>
              </div>
            </div>
            <div class="stat-card" role="status" aria-label="有效会员统计">
              <div class="stat-icon">💎</div>
              <div class="stat-info">
                <div class="stat-label">有效会员</div>
                <div id="stat-valid-members" class="stat-value success">-</div>
              </div>
            </div>
            <div class="stat-card" role="status" aria-label="即将到期统计">
              <div class="stat-icon">⚠️</div>
              <div class="stat-info">
                <div class="stat-label">即将到期</div>
                <div id="stat-expiring-soon" class="stat-value warning">-</div>
              </div>
            </div>
            <div class="stat-card" role="status" aria-label="已到期统计">
              <div class="stat-icon">⏰</div>
              <div class="stat-info">
                <div class="stat-label">已到期</div>
                <div id="stat-expired" class="stat-value danger">-</div>
              </div>
            </div>
          </div>
        </section>

        <!-- 会员续费 -->
        <section id="tab-renewal" class="tab-content">
          <h2 class="page-title">💰 会员续费管理</h2>
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">📋 群组列表</h3>
              <div class="toolbar">
                <input id="group-search" class="input" placeholder="🔍 搜索群号..." aria-label="搜索群号">
                <select id="status-filter" class="input" aria-label="筛选状态">
                  <option value="all">📂 全部状态</option>
                  <option value="active">✅ 有效</option>
                  <option value="soon">⚠️ 即将到期</option>
                  <option value="expired">⏰ 已到期</option>
                </select>
              </div>
            </div>
            <div class="panel-body">
              <table class="table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="select-all" aria-label="全选"></th>
                    <th data-sort="group">群号</th>
                    <th data-sort="status">状态</th>
                    <th data-sort="expiry">到期时间</th>
                    <th data-sort="days">剩余天数</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="groups-table-body"><tr><td colspan="6" class="text-center">加载中...</td></tr></tbody>
              </table>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">💎 生成续费码</h3>
            </div>
            <div class="panel-body">
              <div class="form-row">
                <label>时长</label>
                <input id="gen-length" class="input" type="number" min="1" value="1" style="width:100px;">
                <select id="gen-unit" class="input" style="width:120px;">
                  <option value="天">天</option>
                  <option value="月">月</option>
                  <option value="年">年</option>
                </select>
                <button id="generate-code-btn" class="btn btn-primary btn-sm">生成续费码</button>
              </div>
              <div id="codes-list" class="codes-list"></div>
            </div>
          </div>
        </section>

        <!-- 统计 -->
        <section id="tab-stats" class="tab-content">
          <h2 class="page-title">📈 消息统计</h2>
          <div class="panel">
            <div class="panel-body">
              <div class="stats-grid">
                <div class="stat-box">
                  <div class="stat-box-label">总发送</div>
                  <div id="stats-today-total" class="stat-box-value">-</div>
                </div>
                <div class="stat-box">
                  <div class="stat-box-label">群聊</div>
                  <div id="stats-group-total" class="stat-box-value">-</div>
                </div>
                <div class="stat-box">
                  <div class="stat-box-label">私聊</div>
                  <div id="stats-private-total" class="stat-box-value">-</div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">按 Bot 统计</h3>
              <div class="toolbar">
                <input id="stats-keyword" class="input" placeholder="搜索...">
                <select id="stats-sort" class="input">
                  <option value="total_desc">按总数降序</option>
                  <option value="total_asc">按总数升序</option>
                  <option value="bot_asc">按 ID 升序</option>
                  <option value="bot_desc">按 ID 降序</option>
                  <option value="group_desc">按群聊降序</option>
                  <option value="private_desc">按私聊降序</option>
                </select>
              </div>
            </div>
            <div class="panel-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Bot</th>
                    <th>总数</th>
                    <th>群聊</th>
                    <th>群聊目标</th>
                    <th>私聊</th>
                    <th>私聊目标</th>
                  </tr>
                </thead>
                <tbody id="stats-detail-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 权限 -->
        <section id="tab-permissions" class="tab-content">
          <h2 class="page-title">🔐 权限管理</h2>
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">权限配置</h3>
              <div class="toolbar">
                <button id="open-permissions-json-btn" class="btn">打开 JSON</button>
                <button id="save-permissions-btn" class="btn btn-primary">保存</button>
              </div>
            </div>
            <div class="panel-body">
              <div id="permissions-list" class="perm-list"></div>
            </div>
          </div>
        </section>

        <!-- 配置 -->
        <section id="tab-config" class="tab-content">
          <h2 class="page-title">⚙️ 配置管理</h2>
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">系统配置</h3>
              <div class="toolbar">
                <button id="save-config-btn" class="btn btn-primary">保存</button>
              </div>
            </div>
            <div class="panel-body">
              <textarea id="config-json" class="json-editor" rows="25" placeholder="在此编辑 JSON 配置..." aria-label="配置编辑器"></textarea>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- 权限 JSON 编辑弹窗 -->
  <div id="perm-json-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">编辑权限 JSON</h3>
        <button id="perm-json-close" class="modal-close" title="关闭" aria-label="关闭">×</button>
      </div>
      <div class="modal-body">
        <textarea id="permissions-json" class="json-editor" rows="20" aria-label="权限 JSON 编辑器"></textarea>
      </div>
      <div class="modal-footer">
        <button id="perm-json-cancel" class="btn btn-secondary">取消</button>
        <button id="perm-json-save" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>

  <script src="/membership/static/console.js"></script>
</body>
</html>

