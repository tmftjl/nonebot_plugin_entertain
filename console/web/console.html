<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>今汐管理控制台</title>
  <link rel="stylesheet" href="static/console.css">
</head>
<body>
  <div id="toast-container"></div>
  <div id="loading-overlay" class="hidden">
    <div class="spinner"></div>
    <div class="loading-text">加载中...</div>
  </div>

  <div id="app">
    <header class="top-bar">
      <div class="top-bar-left">
        <h1 class="logo">
          <span class="logo-text">今汐控制台</span>
        </h1>
      </div>
      <div class="top-bar-right">
        <button id="theme-toggle" class="icon-btn">
          <span class="icon">🌙</span>
        </button>
        <button id="refresh-btn" class="icon-btn">
          <span class="icon">🔄</span>
        </button>
      </div>
    </header>

    <div class="main-container">
      <aside class="sidebar">
        <nav class="nav-menu">
          <a href="#dashboard" class="nav-item active" data-tab="dashboard">
            <span class="nav-icon">📊</span>
            <span class="nav-text">仪表盘</span>
          </a>
          <a href="#renewal" class="nav-item" data-tab="renewal">
            <span class="nav-icon">💰</span>
            <span class="nav-text">会员续费</span>
          </a>
          <a href="#stats" class="nav-item" data-tab="stats">
            <span class="nav-icon">📈</span>
            <span class="nav-text">消息统计</span>
          </a>
          <a href="#permissions" class="nav-item" data-tab="permissions">
            <span class="nav-icon">🔐</span>
            <span class="nav-text">权限管理</span>
          </a>
          <a href="#personas" class="nav-item" data-tab="personas">
            <span class="nav-icon">🧠</span>
            <span class="nav-text">人格管理</span>
          </a>
          <a href="#config" class="nav-item" data-tab="config">
            <span class="nav-icon">⚙️</span>
            <span class="nav-text">配置管理</span>
          </a>
        </nav>
      </aside>

      <main class="content-area">
        <section id="tab-dashboard" class="tab-content active">
          <h2 class="page-title">仪表盘总览</h2>
          <div class="stats-cards-compact">
            <div class="stat-card-compact">
              <div class="stat-icon-compact">👥</div>
              <div class="stat-info-compact">
                <div class="stat-label-compact">活跃群组</div>
                <div id="stat-active-groups" class="stat-value-compact">-</div>
              </div>
            </div>
            <div class="stat-card-compact success">
              <div class="stat-icon-compact">💎</div>
              <div class="stat-info-compact">
                <div class="stat-label-compact">有效会员</div>
                <div id="stat-valid-members" class="stat-value-compact">-</div>
              </div>
            </div>
            <div class="stat-card-compact warning">
              <div class="stat-icon-compact">⚠️</div>
              <div class="stat-info-compact">
                <div class="stat-label-compact">即将到期</div>
                <div id="stat-expiring-soon" class="stat-value-compact">-</div>
              </div>
            </div>
            <div class="stat-card-compact danger">
              <div class="stat-icon-compact">⏰</div>
              <div class="stat-info-compact">
                <div class="stat-label-compact">已到期</div>
                <div id="stat-expired" class="stat-value-compact">-</div>
              </div>
            </div>
          </div>
        </section>

        <section id="tab-renewal" class="tab-content">
          <h2 class="page-title">会员续费管理</h2>

          <div class="panel">
            <div class="panel-header">
              <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 10px;">
                  <button id="notify-open-btn" class="btn btn-secondary btn-sm">通知</button>
                  <button id="manual-open-btn" class="btn btn-primary btn-sm">新增/编辑</button>
                </div>
                <div style="display: flex; gap: 10px;">
                  <input id="group-search" class="input" placeholder="搜索群号...">
                  <select id="status-filter" class="input">
                    <option value="all">全部状态</option>
                    <option value="active">有效</option>
                    <option value="soon">即将到期</option>
                    <option value="today">今日到期</option>
                    <option value="expired">已到期</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="select-all"></th>
                    <th data-sort="group">群号</th>
                    <th data-sort="status">状态</th>
                    <th data-sort="expiry">到期时间</th>
                    <th data-sort="days">剩余天数</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="groups-table-body">
                  <tr><td colspan="6" class="text-center">加载中...</td></tr>
                </tbody>
              </table>
              <div id="groups-pagination" class="pagination-container">
                <div class="pagination-info">
                  <span id="pagination-info-text">共 0 条记录</span>
                </div>
                <div class="pagination-controls">
                  <button id="pagination-first" class="pagination-btn">⏮</button>
                  <button id="pagination-prev" class="pagination-btn">◀</button>
                  <span id="pagination-pages" class="pagination-pages"></span>
                  <button id="pagination-next" class="pagination-btn">▶</button>
                  <button id="pagination-last" class="pagination-btn">⏭</button>
                </div>
                <div class="pagination-size">
                  <label>
                    <span>每页</span>
                    <select id="pagination-size-select" class="pagination-size-select">
                      <option value="10">10</option>
                      <option value="20" selected>20</option>
                      <option value="50">50</option>
                      <option value="100">100</option>
                    </select>
                    <span>条</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">续费码管理</h3>
            </div>
            <div class="panel-body">
              <div class="renewal-generate-section">
                <h4 class="section-subtitle">生成新续费码</h4>
                <div class="toolbar">
                  <label>
                    <span>时长</span>
                    <input id="renewal-length" type="number" min="1" value="30" class="form-input-sm">
                  </label>
                  <label>
                    <span>单位</span>
                    <select id="renewal-unit" class="form-select-sm">
                      <option value="天">天</option>
                      <option value="月">月</option>
                      <option value="年">年</option>
                    </select>
                  </label>
                  <button id="generate-code-btn" class="btn btn-primary btn-sm">生成</button>
                </div>
              </div>

              <div class="divider"></div>

              <div class="renewal-codes-section">
                <h4 class="section-subtitle">待使用的续费码</h4>
                <div id="codes-list" class="codes-grid">
                  <div class="empty-state">暂无待使用的续费码</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="tab-stats" class="tab-content">
          <h2 class="page-title">消息统计分析</h2>

          <div class="stats-overview-compact">
            <div class="stat-box-compact">
              <div class="stat-box-icon">📨</div>
              <div class="stat-box-info">
                <div class="stat-box-label">今日总消息</div>
                <div id="stats-today-total" class="stat-box-value">-</div>
              </div>
            </div>
            <div class="stat-box-compact">
              <div class="stat-box-icon">👥</div>
              <div class="stat-box-info">
                <div class="stat-box-label">群聊消息</div>
                <div id="stats-group-total" class="stat-box-value">-</div>
              </div>
            </div>
            <div class="stat-box-compact">
              <div class="stat-box-icon">💬</div>
              <div class="stat-box-info">
                <div class="stat-box-label">私聊消息</div>
                <div id="stats-private-total" class="stat-box-value">-</div>
              </div>
            </div>
            <div class="stat-box-compact">
              <div class="stat-box-icon">👥</div>
              <div class="stat-box-info">
                <div class="stat-box-label">群聊数</div>
                <div id="stats-group-count" class="stat-box-value">-</div>
              </div>
            </div>
            <div class="stat-box-compact">
              <div class="stat-box-icon">💬</div>
              <div class="stat-box-info">
                <div class="stat-box-label">私聊人数</div>
                <div id="stats-private-count" class="stat-box-value">-</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">Bot明细数据</h3>
            </div>
            <div id="stats-bots-accordion" class="stats-accordion">
              <div class="empty-state">暂无数据</div>
            </div>
          </div>
        </section>

        <section id="tab-personas" class="tab-content">
          <h2 class="page-title">AI 对话 · 人格管理</h2>

          <div class="panel">
            <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3 class="panel-title">人格列表</h3>
              <div class="toolbar-right">
                <button id="persona-refresh-btn" class="btn btn-secondary">刷新</button>
                <button id="persona-create-open" class="btn btn-primary">新增人格</button>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>名称</th>
                    <th style="width: 160px;">操作</th>
                  </tr>
                </thead>
                <tbody id="personas-table-body">
                  <tr><td colspan="4" class="text-center">加载中...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="tab-permissions" class="tab-content">
          <h2 class="page-title">权限管理中心</h2>
          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">权限配置</h3>
              <div class="toolbar-right">
                <button id="open-permissions-json-btn" class="btn btn-secondary">编辑JSON</button>
                <button id="save-permissions-btn" class="btn btn-primary">保存配置</button>
              </div>
            </div>
            <div id="permissions-list" class="perm-accordion"></div>
          </div>
        </section>

        <section id="tab-config" class="tab-content">
          <h2 class="page-title">配置管理中心</h2>

          <div class="config-panel">
            <div id="config-tabs-nav" class="config-tabs-nav">
              <div class="empty-state">正在加载配置...</div>
            </div>

            <div id="config-tabs-content" class="config-tabs-content">
              <div class="empty-state">请选择一个配置项</div>
            </div>

            <div class="config-footer">
              <button id="config-save-btn" class="btn btn-primary">保存当前配置</button>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <div id="perm-json-modal" class="modal hidden">
    <div class="modal-dialog">
      <div class="modal-header">
        <h3 class="panel-title">编辑权限JSON</h3>
        <button id="perm-json-close" class="modal-close">✖</button>
      </div>
      <div class="modal-body">
        <textarea id="permissions-json" class="json-editor" rows="20" placeholder="在此处编辑权限JSON配置..."></textarea>
      </div>
      <div class="modal-footer">
        <button id="perm-json-cancel" class="btn btn-secondary">取消</button>
        <button id="perm-json-save" class="btn btn-primary">保存JSON</button>
      </div>
    </div>
  </div>

  <div id="notify-modal" class="modal hidden">
    <div class="modal-dialog modal-modern">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">📣</div>
          <h3 class="modal-title">发送通知</h3>
        </div>
        <button id="notify-close" class="modal-close">✖</button>
      </div>
      <div class="modal-body">
        <div class="info-badge">
          <span class="info-label">已选择</span>
          <span id="notify-selected-count" class="info-value">0</span>
          <span class="info-label">个群</span>
        </div>

        <div class="form-group-modern">
          <label class="form-label">
            <span class="label-icon">📝</span>
            <span>消息文本</span>
          </label>
          <textarea id="notify-text" class="form-textarea" rows="6" placeholder="输入要发送的消息内容..."></textarea>
        </div>

        <div class="form-group-modern">
          <label class="form-label">
            <span class="label-icon">🖼️</span>
            <span>图片附件</span>
            <span class="label-hint">(可多选)</span>
          </label>
          <input type="file" id="notify-images" accept="image/*" multiple class="file-input" />
        </div>

        <div id="notify-image-previews" class="image-previews"></div>
      </div>
      <div class="modal-footer">
        <button id="notify-cancel" class="btn btn-secondary">取消</button>
        <button id="notify-confirm" class="btn btn-primary">发送</button>
      </div>
    </div>
  </div>

  <div id="extend-modal" class="modal hidden">
    <div class="modal-dialog modal-modern">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">🛠</div>
          <h3 class="modal-title" id="extend-modal-title">新增/修改群</h3>
        </div>
        <button id="extend-close" class="modal-close">✖</button>
      </div>
      <div class="modal-body">
        <div class="form-group-modern">
          <label class="form-label">
            <span>群号</span>
            <span class="label-hint" style="color: red;">*</span>
          </label>
          <input id="extend-group-id" class="form-input" placeholder="输入群号（必填）" />
        </div>

        <div class="form-group-modern">
          <label class="form-label">
            <span>到期时间</span>
            <span class="label-hint">(格式: YYYY-MM-DD HH:mm:ss，新增时与续费时长二选一必填)</span>
          </label>
          <input id="extend-expiry-date" class="form-input" type="datetime-local" placeholder="到期时间" />
        </div>

        <div class="form-group-modern">
          <label class="form-label">
            <span>续费时长</span>
            <span class="label-hint">(快捷操作，新增时与到期时间二选一必填)</span>
          </label>
          <div class="input-group">
            <input id="extend-length" class="form-input" type="number" min="0" value="0" placeholder="0表示不续费" />
            <select id="extend-unit" class="form-select">
              <option value="天">天</option>
              <option value="月">月</option>
              <option value="年">年</option>
            </select>
          </div>
        </div>

        <div class="form-group-modern">
          <label class="form-label">
            <span>管理Bot</span>
            <span class="label-hint" style="color: red;">*</span>
          </label>
          <input id="extend-bot-id" class="form-input" placeholder="请输入要使用的Bot自编号" />
        </div>

        <div class="form-group-modern">
          <label class="form-label">
            <span>续费人</span>
            <span class="label-hint" style="color: red;">*</span>
          </label>
          <input id="extend-renewer" class="form-input" placeholder="填写操作人/续费人" />
        </div>

        <div class="form-group-modern">
          <label class="form-label">备注</label>
          <input id="extend-remark" class="form-input" placeholder="备注信息（可选）" />
        </div>

        <div id="extend-current-info" class="info-text"></div>
      </div>
      <div class="modal-footer">
        <button id="extend-cancel" class="btn btn-secondary">取消</button>
        <button id="extend-confirm" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>

  <div id="persona-modal" class="modal hidden">
    <div class="modal-dialog modal-modern">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">🧠</div>
          <h3 class="modal-title" id="persona-modal-title">新增人格</h3>
        </div>
        <button id="persona-close" class="modal-close">✖</button>
      </div>
      <div class="modal-body">
        <div class="form-group-modern">
          <label class="form-label">
            <span>人格代号</span>
            <span class="label-hint" style="color: red;">*</span>
          </label>
          <input id="persona-key" class="form-input" placeholder="仅字母数字、下划线、连字符" />
        </div>

        <div class="form-group-modern">
          <label class="form-label"><span>显示名称</span></label>
          <input id="persona-name" class="form-input" placeholder="例如：默认助手" />
        </div>

        <div class="form-group-modern">
          <label class="form-label"><span>描述</span></label>
          <input id="persona-description" class="form-input" placeholder="一句话描述此人格" />
        </div>

        <div class="form-group-modern">
          <label class="form-label"><span>系统提示词（System Prompt）</span></label>
          <textarea id="persona-system-prompt" class="form-textarea" rows="10" placeholder="输入此人格的系统提示词..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id="persona-cancel" class="btn btn-secondary">取消</button>
        <button id="persona-save" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>

  <script src="static/console.js"></script>
</body>
</html>

